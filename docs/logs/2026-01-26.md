---
date: 2026-01-26
project: quench-markdown-editor
version: 0.0.1
---

# 開発ログ（2026-01-26）

## 目的
- 画像まわりを「美しいLive Preview」に寄せる（サイズ指定、貼り付け/ドロップ、参照切れの明示）
- 開発ログ運用をリポジトリ内で定義する

## 実施内容

### 開発ログ運用
- `docs/logs/` を追加し、セッションログを残す運用を導入
- `AGENTS.md` に `docs/logs/` 運用ルールを追記

### 画像の参照切れを明示
- 画像のWebview URI解決時に、ローカルファイルの存在確認（`vscode.workspace.fs.stat`）を行い、
  - 存在しない場合は `RESOURCE_URI_RESULT: ok=false, error=not_found` を返す
- Webview側で `RESOURCE_URI_RESULT` の失敗をキャッシュし、画像ウィジェットで「読み込めません」を表示

### GitHub互換のサイズ指定（表示）
- `![[...|200]]` は GitHub互換にならないため採用せず、GitHubでも描画されるHTMLを利用
  - 例: `<img src="images/sample.png" width="200" />` / `<img src="..." width="200" height="120">`
- Live Preview側で `<img ...>` を読み取り、`width/height` を反映して表示

### GitHub互換のサイズ指定（編集）
- コマンド `Quench: Resize Image (GitHub-compatible)` を追加
  - カーソル行の `![](...)` を `<img src="..." width="...">` に変換してサイズ付与
  - 既存の `<img ...>` がある場合は `width/height` を更新
  - 空入力で `width/height` を削除

## 変更箇所
- `src/webview/main.ts`（画像の解決キャッシュ/エラー表示、HTML img表示、画像ウィジェット拡張）
- `src/extension/QuenchEditorProvider.ts`（ローカル画像の存在確認、Resizeコマンド実装）
- `src/extension/services/AttachmentService.ts`（resourceスコープ設定に追従するため `getQuenchSettings(uri)` 化）
- `media/base.css`（画像埋め込みの余白、エラー表示スタイル）
- `src/extension.ts` / `package.json`（`quench.resizeImage` コマンド追加）
- `AGENTS.md` / `docs/logs/2026-01-25.md`

## 実行したコマンド（主要）
- `npm run build`
- `npx vsce package -o quench-markdown-editor-0.0.1.vsix`
- `code --install-extension ./quench-markdown-editor-0.0.1.vsix --force`

## 動作確認メモ
- 変更をVS Codeに反映するには `Developer: Reload Window` が必要
